<script>
    function submitShifts() {
        const accessToken = localStorage.getItem("google_access_token");
        if (!accessToken) {
            alert("Please sign in first!");
            return;
        }

        const timeZone = "America/New_York";
        const calendarId = "primary"; // Replace with your calendar ID if needed

        Object.keys(selectedDays).forEach(index => {
            const shift = shiftOptions[selectedDays[index]];
            const dateString = weekDates[index];

            if (!shift) {
                // Delete existing events
                fetch(`https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?q=Work Shift&timeMin=${dateString}T00:00:00Z&timeMax=${dateString}T23:59:59Z`, {
                    method: "GET",
                    headers: { Authorization: `Bearer ${accessToken}` }
                })
                .then(response => response.json())
                .then(data => {
                    data.items.forEach(event => {
                        fetch(`https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events/${event.id}`, {
                            method: "DELETE",
                            headers: { Authorization: `Bearer ${accessToken}` }
                        }).then(() => console.log(`Deleted shift on ${dateString}`));
                    });
                });
            } else {
                // Insert new event
                const startTime = shift.split("-")[0] + ":00";
                const event = {
                    summary: "Work Shift",
                    start: { dateTime: `${dateString}T${startTime}-05:00`, timeZone: timeZone },
                    end: { dateTime: `${dateString}T23:00:00-05:00`, timeZone: timeZone }
                };

                fetch(`https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events`, {
                    method: "POST",
                    headers: {
                        Authorization: `Bearer ${accessToken}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(event)
                }).then(response => response.json())
                .then(data => alert(`Shift added for ${dateString}`))
                .catch(error => alert("Failed to add shift: " + error));
            }
        });
    }
</script>
